<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Quiz - Participante</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
:root{--bg:#0f1720;--card:#0b1220;--accent:#0ea5ff;--text:#e6eef8}
body{font-family:Inter,Arial,Helvetica,sans-serif;background:#071126;color:var(--text);margin:0;padding:18px;display:flex;flex-direction:column;gap:16px}
.card{background:rgba(255,255,255,0.03);padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.4)}
.hidden{display:none !important}
h2,h3{margin:0 0 12px 0}
button{background:var(--accent);color:#012;border:none;padding:12px 20px;border-radius:10px;font-weight:700;font-size:18px;cursor:pointer;margin-top:20px}
.option{display:block;margin:10px 0;padding:10px;background:rgba(255,255,255,0.05);border-radius:8px;cursor:pointer}
.option.selected{background:var(--accent);color:#012}
.status{font-size:16px;color:rgba(255,255,255,0.9);margin-top:8px}
</style>
</head>
<body>

<div id="nameScreen" class="card center">
<h2>Digite seu nome</h2>
<input type="text" id="playerName" placeholder="Seu nome" style="padding:10px; font-size:16px; border-radius:6px; border:none;">
<button id="enterNameBtn">Entrar</button>
</div>

<div id="scoreDisplay" class="status hidden">Pontos: 0</div>

<div id="quizScreen" class="card hidden">
<h3 id="questionText"></h3>
<div id="optionsContainer"></div>
<button id="nextBtn" class="hidden">Próxima</button>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
document.addEventListener('DOMContentLoaded', ()=>{

const socket = io();
const nameScreen = document.getElementById('nameScreen');
const playerNameInput = document.getElementById('playerName');
const enterNameBtn = document.getElementById('enterNameBtn');
const scoreDisplay = document.getElementById('scoreDisplay');
const quizScreen = document.getElementById('quizScreen');
const questionText = document.getElementById('questionText');
const optionsContainer = document.getElementById('optionsContainer');
const nextBtn = document.getElementById('nextBtn');

let playerName = '';
let questions = [];
let currentIndex = 0;
let startTime = 0;
let score = 0;

enterNameBtn.onclick = ()=>{
  const name = playerNameInput.value.trim();
  if(!name) return alert('Digite seu nome!');
  playerName = name;
  socket.emit('participant-join',{name: playerName});
  nameScreen.classList.add('hidden');
  scoreDisplay.classList.remove('hidden');
};

socket.on('quiz-start',(data)=>{
  questions = data.questions;
  currentIndex = 0;
  showQuestion();
});

function showQuestion(){
  if(currentIndex >= questions.length){
    socket.emit('participant-finished');
    quizScreen.classList.add('hidden');
    alert('Você terminou o quiz! Aguarde o ranking.');
    return;
  }
  const q = questions[currentIndex];
  questionText.textContent = q.question;
  optionsContainer.innerHTML='';
  q.options.forEach((opt,i)=>{
    const div = document.createElement('div');
    div.textContent = opt;
    div.classList.add('option');
    div.onclick = ()=>selectAnswer(i);
    optionsContainer.appendChild(div);
  });
  startTime = Date.now();
  nextBtn.classList.add('hidden');
  quizScreen.classList.remove('hidden');
}

function selectAnswer(selected){
  const options = document.querySelectorAll('.option');
  options.forEach(o=>o.classList.remove('selected'));
  options[selected].classList.add('selected');
  const timeTaken = (Date.now()-startTime)/1000;
  socket.emit('answer',{questionId: questions[currentIndex].id, selected, timeTaken});
  nextBtn.classList.remove('hidden');
}

nextBtn.onclick = ()=>{
  currentIndex++;
  showQuestion();
};

socket.on('updateScore',(data)=>{
  score = data.score;
  scoreDisplay.textContent = `Pontos: ${score}`;
});

});
</script>

</body>
</html>
